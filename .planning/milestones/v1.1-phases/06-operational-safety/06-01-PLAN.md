---
phase: 06-operational-safety
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/mcp_json_yaml_toml/backends/binary_manager.py
autonomous: true

must_haves:
  truths:
    - "binary_manager.py emits structured log records instead of print() to stderr"
    - "No print() calls remain in binary_manager.py (except __all__ exports)"
    - "Log levels match message severity (info for progress, warning for fallbacks, debug for details)"
  artifacts:
    - path: "packages/mcp_json_yaml_toml/backends/binary_manager.py"
      provides: "Logging-based binary management"
      contains: "logger = logging.getLogger(__name__)"
  key_links:
    - from: "packages/mcp_json_yaml_toml/backends/binary_manager.py"
      to: "logging module"
      via: "module-level logger"
      pattern: "logger\\.(info|warning|debug|error)"
---

<objective>
Replace all `print(..., file=sys.stderr)` calls in binary_manager.py with stdlib `logging` module calls.

Purpose: print() to stderr interferes with MCP JSON-RPC transport. Structured logging allows proper capture, filtering, and analysis of operational events.
Output: binary_manager.py using `logging.getLogger(__name__)` for all diagnostic output.
</objective>

<execution_context>
@/home/ubuntulinuxqa2/.claude/get-shit-done/workflows/execute-plan.md
@/home/ubuntulinuxqa2/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/mcp_json_yaml_toml/backends/binary_manager.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate binary_manager.py from print() to logging module</name>
  <files>packages/mcp_json_yaml_toml/backends/binary_manager.py</files>
  <action>
Replace all `print(..., file=sys.stderr)` calls in binary_manager.py with appropriate `logging` calls.

1. Add `import logging` to the imports section (stdlib, alphabetical order).
2. Add `logger = logging.getLogger(__name__)` after the module-level constants (after DEFAULT_YQ_CHECKSUMS).
3. Remove `import sys` if it becomes unused after removing print() calls (check: sys is only used for `file=sys.stderr` in print calls â€” verify no other sys usage before removing).
4. Replace each print() call with the appropriate log level:

**Level mapping:**

- Progress messages (user-relevant operational updates):
  - `"Downloading yq {version} for your platform..."` -> `logger.info`
  - `"Fetching checksums..."` -> `logger.info`
  - `"Downloading {github_name}..."` -> `logger.info`
  - `"Verifying checksum..."` -> `logger.info`
  - `"Successfully downloaded and verified {binary_name}"` -> `logger.info`
  - `"Auto-download successful. Binary stored at: {storage_binary}"` -> `logger.info`
  - `"Cleaned up old version: {old_binary.name}"` -> `logger.info`

- Informational/status messages:
  - `"Binary already exists at {dest_path}"` -> `logger.debug`
  - `"Binary already downloaded by another process at {dest_path}"` -> `logger.debug`
  - `"Using system-installed yq at: {system_yq}"` -> `logger.info`

- Fallback/advisory messages:
  - `"Found yq at ... but it's not mikefarah/yq"` -> `logger.warning`
  - `"Found yq {system_version} ... but need >= {pinned_version}"` -> `logger.warning`
  - `"Note: Could not remove old binary ..."` -> `logger.warning`

- Auto-download notice block (4 consecutive prints at lines 573-585):
  - `"yq binary not found for {system}/{arch}"` -> `logger.info`
  - `"Attempting to auto-download..."` -> `logger.info`
  - `"Tip: Install yq via package manager..."` -> `logger.info`
  - `"macOS: brew install yq | ..."` -> `logger.info`

5. Use lazy %-formatting for ALL logging calls (not f-strings):
   - `logger.info("Downloading yq %s for your platform...", version)` (not `logger.info(f"Downloading yq {version}...")`)
   - For messages with no variables, use plain strings: `logger.info("Fetching checksums...")`
   - For multi-variable messages: `logger.warning("Found yq %s at %s but need >= %s. Will download minimum required version.", system_version, yq_path, pinned_version)`

6. Preserve all `# pragma: no cover` comments on the same lines/blocks.
   </action>
   <verify>
   Run: `uv run prek run --files packages/mcp_json_yaml_toml/backends/binary_manager.py`

Additionally verify:

- `grep -c 'print(' packages/mcp_json_yaml_toml/backends/binary_manager.py` returns 0
- `grep -c 'logger\.' packages/mcp_json_yaml_toml/backends/binary_manager.py` returns count >= 16
- `grep 'import sys' packages/mcp_json_yaml_toml/backends/binary_manager.py` returns nothing (if sys is fully removed)
- `uv run pytest packages/mcp_json_yaml_toml/tests/ -x -q` passes
  </verify>
  <done>
  All 16 print() calls in binary_manager.py replaced with logging module calls using lazy %-formatting. No print() calls remain. All linters and tests pass.
  </done>
  </task>

</tasks>

<verification>
1. `grep -c 'print(' packages/mcp_json_yaml_toml/backends/binary_manager.py` returns 0
2. `grep 'logger = logging.getLogger' packages/mcp_json_yaml_toml/backends/binary_manager.py` returns match
3. `uv run prek run --files packages/mcp_json_yaml_toml/backends/binary_manager.py` passes all gates
4. `uv run pytest packages/mcp_json_yaml_toml/tests/ -x -q` passes
</verification>

<success_criteria>

- binary_manager.py contains zero print() calls
- All diagnostic output uses logging module with appropriate levels
- All logging calls use lazy %-formatting (no f-strings in log calls)
- All quality gates pass
  </success_criteria>

<output>
After completion, create `.planning/phases/06-operational-safety/06-01-SUMMARY.md`
</output>
